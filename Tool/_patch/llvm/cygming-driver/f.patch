diff --git a/clang/lib/Driver/ToolChains/MinGW.cpp b/clang/lib/Driver/ToolChains/MinGW.cpp
index c81a7ed17029..bafa3f7475cf 100644
--- a/clang/lib/Driver/ToolChains/MinGW.cpp
+++ b/clang/lib/Driver/ToolChains/MinGW.cpp
@@ -162,11 +173,32 @@ void tools::MinGW::Linker::ConstructJob(Compilation &C, const JobAction &JA,
     CmdArgs.push_back("-Bdynamic");
   if (Args.hasArg(options::OPT_mdll) || Args.hasArg(options::OPT_shared)) {
     CmdArgs.push_back("-e");
-    if (TC.getArch() == llvm::Triple::x86)
-      CmdArgs.push_back("_DllMainCRTStartup@12");
-    else
-      CmdArgs.push_back("DllMainCRTStartup");
+    if (isCygwin) {
+      if (TC.getArch() == llvm::Triple::x86) {
+        CmdArgs.push_back("__cygwin_dll_entry@12");
+      } else {
+        CmdArgs.push_back("_cygwin_dll_entry");
+      }
+    } else {
+      if (TC.getArch() == llvm::Triple::x86) {
+        CmdArgs.push_back("_DllMainCRTStartup@12");
+      } else {
+        CmdArgs.push_back("DllMainCRTStartup");
+      }
+    }
     CmdArgs.push_back("--enable-auto-image-base");
+  } else {
+    if (!isCygwin) {
+      if (Args.hasArg(options::OPT_no_pie)) {
+        CmdArgs.push_back("--disable-dynamicbase");
+      }
+    }
+    if (TC.getArch() == llvm::Triple::x86) {
+      CmdArgs.push_back("--large-address-aware");
+    }
+  }
+  if (isCygwin) {
+    CmdArgs.push_back("--dynamicbase");
   }
 
   if (Args.hasArg(options::OPT_Z_Xlinker__no_demangle))
